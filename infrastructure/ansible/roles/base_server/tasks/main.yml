---
- name: Mettre à jour la liste des paquets (Ubuntu/Debian)
  ansible.builtin.apt:
    update_cache: yes
    cache_valid_time: 3600

- name: Mettre à niveau les paquets
  ansible.builtin.apt:
    upgrade: dist
  register: upgrade_result

- name: Installer les paquets de base
  ansible.builtin.apt:
    name:
      - curl
      - git
      - htop
      - vim
      - net-tools
      - ca-certificates
    state: present

- name: Régler la timezone sur Europe/Paris
  ansible.builtin.timezone:
    name: Europe/Paris

- name: Installer ufw
  ansible.builtin.apt:
    name: ufw
    state: present

- name: Autoriser SSH dans ufw
  community.general.ufw:
    rule: allow
    name: OpenSSH

- name: Autoriser HTTP (80) dans ufw
  community.general.ufw:
    rule: allow
    port: "80"
    proto: tcp

- name: Autoriser HTTPS (443) dans ufw
  community.general.ufw:
    rule: allow
    port: "443"
    proto: tcp

- name: Activer ufw
  community.general.ufw:
    state: enabled